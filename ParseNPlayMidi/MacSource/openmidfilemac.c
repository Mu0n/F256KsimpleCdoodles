//opening the .midi file and getting the whole content into a char array for later// analysis.// Mac version#include "stdio.h"extern OSErr gOSErr;extern Boolean gVerbo;extern Handle gMidiBuf;extern short gFileNum; //file number for opened .mid fileextern long gFileSize; //keeps track of how many bytes in the fileshort openMIDIFile(void);short openMIDIFile(void)	{  	SFReply reply; /* used in file operations */  	SFTypeList myTypes; /* used in file operations */  	Point where = {50,50}; /* top left corner of Std file window */  	myTypes[0]='MIDI';   /* Those are the possible file type codes */  	myTypes[1]='MID ';   /* no idea if this one is used, but let's put it for good measure */    	SFGetFile(where,"\pSelect a MIDI file",0L,1,myTypes,0L,&reply);  	if(reply.good)    	{    	gOSErr = FSOpen(reply.fName,reply.vRefNum,&gFileNum);    	if(gOSErr != noErr)     		{    		printf("Error opening the midi file\n");    		return -1;   	    		}    	else     		{    		gOSErr = GetEOF(gFileNum, &gFileSize);    		if(gOSErr != noErr)     			{    			printf("Can't get the file size\n");    			return -1;    			}    		else     			{    			if(gVerbo) printf("file %s found and opened refnum=%d at %ld bytes\n",PtoCstr(reply.fName),gFileNum,gFileSize);    			if(gMidiBuf != NULL) DisposHandle((Handle)gMidiBuf);    			gMidiBuf = (char **) NewHandle(gFileSize);    			if(gMidiBuf == NULL) printf("Couldn't allocate ram to read %s\n",PtoCstr(reply.fName));    			    			HLock((Handle)gMidiBuf);    			gOSErr = FSRead(gFileNum, &gFileSize, *gMidiBuf);    			HUnlock((Handle)gMidiBuf);    			    			if(gOSErr != noErr)    				{    				printf("ERROR: couldn't read the midi file data\n");    				DisposHandle(gMidiBuf);    				FSClose(gFileNum);    				return -1;    				}    			FSClose(gFileNum);    			return gFileNum; //the good scenario happens here    			}    		}    	}    return -1; //either there's a mistake in the file dialog fetching routine, or no file was selected	}